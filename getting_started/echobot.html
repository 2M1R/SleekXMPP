
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SleekXMPP Quickstart - Echo Bot &mdash; SleekXMPP</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0RC3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="SleekXMPP" href="../index.html" />
    <link rel="next" title="Sign in, Send a Message, and Disconnect" href="sendlogout.html" />
    <link rel="prev" title="SleekXMPP" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sendlogout.html" title="Sign in, Send a Message, and Disconnect"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="SleekXMPP"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">1.0RC3 Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="sleekxmpp-quickstart-echo-bot">
<span id="echobot"></span><h1>SleekXMPP Quickstart - Echo Bot<a class="headerlink" href="#sleekxmpp-quickstart-echo-bot" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have any issues working through this quickstart guide
or the other tutorials here, please either send a message to the
<a class="reference external" href="http://groups.google.com/group/sleekxmpp-discussion">mailing list</a>
or join the chat room at <a class="reference external" href="xmpp:sleek&#64;conference.jabber.org?join">sleek&#64;conference.jabber.org</a>.</p>
</div>
<p>If you have not yet installed SleekXMPP, do so now by either checking out a version
from <a class="reference external" href="http://github.com/fritzy/SleekXMPP">Github</a>, or installing it using <tt class="docutils literal"><span class="pre">pip</span></tt>
or <tt class="docutils literal"><span class="pre">easy_install</span></tt>.</p>
<div class="highlight-sh"><div class="highlight"><pre>pip install sleekxmpp  <span class="c"># Or: easy_install sleekxmpp</span>
</pre></div>
</div>
<p>As a basic starting project, we will create an echo bot which will reply to any
messages sent to it. We will also go through adding some basic command line configuration
for enabling or disabling debug log outputs and setting the username and password
for the bot.</p>
<p>For the command line options processing, we will use the built-in <tt class="docutils literal"><span class="pre">optparse</span></tt>
module and the <tt class="docutils literal"><span class="pre">getpass</span></tt> module for reading in passwords.</p>
<div class="section" id="tl-dr-just-give-me-the-code">
<h2>TL;DR Just Give Me the Code<a class="headerlink" href="#tl-dr-just-give-me-the-code" title="Permalink to this headline">¶</a></h2>
<p>As you wish: <a class="reference internal" href="#echobot-complete"><em>the completed example</em></a>.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>To get started, here is a brief outline of the structure that the final project will have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>

<span class="kn">import</span> <span class="nn">sleekxmpp</span>

<span class="sd">&#39;&#39;&#39;Here we will create out echo bot class&#39;&#39;&#39;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Here we will configure and read command line options&#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;Here we will instantiate our echo bot&#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;Finally, we connect the bot and start listening for messages&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="default-encoding">
<h2>Default Encoding<a class="headerlink" href="#default-encoding" title="Permalink to this headline">¶</a></h2>
<p>XMPP requires support for UTF-8 and so SleekXMPP must use UTF-8 as well. In
Python3 this is simple because Unicode is the default string type. For Python2.6+
the situation is not as easy because standard strings are simply byte arrays and
use ASCII. We can get Python to use UTF-8 as the default encoding by including:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
    <span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Until we are able to ensure that SleekXMPP will always use Unicode in Python2.6+, this
may cause issues embedding SleekXMPP into other applications which assume ASCII encoding.</p>
</div>
</div>
<div class="section" id="creating-the-echobot-class">
<h2>Creating the EchoBot Class<a class="headerlink" href="#creating-the-echobot-class" title="Permalink to this headline">¶</a></h2>
<p>There are three main types of entities within XMPP — servers, components, and
clients. Since our echo bot will only be responding to a few people, and won&#8217;t need
to remember thousands of users, we will use a client connection. A client connection
is the same type that you use with your standard IM client such as Pidgin or Psi.</p>
<p>SleekXMPP comes with a <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP" title="sleekxmpp.clientxmpp.ClientXMPP"><tt class="xref py py-class docutils literal"><span class="pre">ClientXMPP</span></tt></a> class
which we can extend to add our message echoing feature. <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP" title="sleekxmpp.clientxmpp.ClientXMPP"><tt class="xref py py-class docutils literal"><span class="pre">ClientXMPP</span></tt></a>
requires the parameters <tt class="docutils literal"><span class="pre">jid</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt>, so we will let our <tt class="docutils literal"><span class="pre">EchoBot</span></tt> class accept those
as well.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EchoBot</span><span class="p">(</span><span class="n">sleekxmpp</span><span class="o">.</span><span class="n">ClientXMPP</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EchoBot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="handling-session-start">
<h3>Handling Session Start<a class="headerlink" href="#handling-session-start" title="Permalink to this headline">¶</a></h3>
<p>The XMPP spec requires clients to broadcast its presence and retrieve its roster (buddy list) once
it connects and establishes a session with the XMPP server. Until these two tasks are completed,
some servers may not deliver or send messages or presence notifications to the client. So we now
need to be sure that we retrieve our roster and send an initial presence once the session has
started. To do that, we will register an event handler for the <a class="reference internal" href="../event_index.html#term-session-start"><em class="xref std std-term">session_start</em></a> event.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
   <span class="nb">super</span><span class="p">(</span><span class="n">EchoBot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

   <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="s">&#39;session_start&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we want the method <tt class="docutils literal"><span class="pre">self.start</span></tt> to execute when the <a class="reference internal" href="../event_index.html#term-session-start"><em class="xref std std-term">session_start</em></a> event is triggered,
we also need to define the <tt class="docutils literal"><span class="pre">self.start</span></tt> handler.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send_presence</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_roster</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Not sending an initial presence and retrieving the roster when using a client instance can
prevent your program from receiving presence notifications or messages depending on the
XMPP server you have chosen.</p>
</div>
<p>Our event handler, like every event handler, accepts a single parameter which typically is the stanza
that was received that caused the event. In this case, <tt class="docutils literal"><span class="pre">event</span></tt> will just be an empty dictionary since
there is no associated data.</p>
<p>Our first task of sending an initial presence is done using <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.send_presence" title="sleekxmpp.basexmpp.BaseXMPP.send_presence"><tt class="xref py py-meth docutils literal"><span class="pre">send_presence</span></tt></a>.
Calling <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.send_presence" title="sleekxmpp.basexmpp.BaseXMPP.send_presence"><tt class="xref py py-meth docutils literal"><span class="pre">send_presence</span></tt></a> without any arguments will send the simplest
stanza allowed in XMPP:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;presence</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The second requirement is fulfilled using <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP.get_roster" title="sleekxmpp.clientxmpp.ClientXMPP.get_roster"><tt class="xref py py-meth docutils literal"><span class="pre">get_roster</span></tt></a>, which
will send an IQ stanza requesting the roster to the server and then wait for the response. You may be wondering
what <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP.get_roster" title="sleekxmpp.clientxmpp.ClientXMPP.get_roster"><tt class="xref py py-meth docutils literal"><span class="pre">get_roster</span></tt></a> returns since we are not saving any return
value. The roster data is saved by an internal handler to <tt class="docutils literal"><span class="pre">self.roster</span></tt>, and in the case of a <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP" title="sleekxmpp.clientxmpp.ClientXMPP"><tt class="xref py py-class docutils literal"><span class="pre">ClientXMPP</span></tt></a> instance to <tt class="docutils literal"><span class="pre">self.client_roster</span></tt>. (The difference between <tt class="docutils literal"><span class="pre">self.roster</span></tt> and
<tt class="docutils literal"><span class="pre">self.client_roster</span></tt> is that <tt class="docutils literal"><span class="pre">self.roster</span></tt> supports storing roster information for multiple JIDs, which is useful
for components, whereas <tt class="docutils literal"><span class="pre">self.client_roster</span></tt> stores roster data for just the client&#8217;s JID.)</p>
<p>It is possible for a timeout to occur while waiting for the server to respond, which can happen if the
network is excessively slow or the server is no longer responding. In that case, an <tt class="xref py py-class docutils literal"><span class="pre">IQTimeout</span></tt> is raised. Similarly, an <tt class="xref py py-class docutils literal"><span class="pre">IQError</span></tt> exception can
be raised if the request contained bad data or requested the roster for the wrong user. In either case, you can wrap the
<tt class="docutils literal"><span class="pre">get_roster()</span></tt> call in a <tt class="docutils literal"><span class="pre">try</span></tt>/<tt class="docutils literal"><span class="pre">except</span></tt> block to retry the roster retrieval process.</p>
<p>The XMPP stanzas from the roster retrieval process could look like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;iq</span> <span class="na">type=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;query</span> <span class="na">xmlns=</span><span class="s">&quot;jabber:iq:roster&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/iq&gt;</span>

<span class="nt">&lt;iq</span> <span class="na">type=</span><span class="s">&quot;result&quot;</span> <span class="na">to=</span><span class="s">&quot;echobot@example.com&quot;</span> <span class="na">from=</span><span class="s">&quot;example.com&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;query</span> <span class="na">xmlns=</span><span class="s">&quot;jabber:iq:roster&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">jid=</span><span class="s">&quot;friend@example.com&quot;</span> <span class="na">subscription=</span><span class="s">&quot;both&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/query&gt;</span>
<span class="nt">&lt;/iq&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="responding-to-messages">
<h3>Responding to Messages<a class="headerlink" href="#responding-to-messages" title="Permalink to this headline">¶</a></h3>
<p>Now that an <tt class="docutils literal"><span class="pre">EchoBot</span></tt> instance handles <a class="reference internal" href="../event_index.html#term-session-start"><em class="xref std std-term">session_start</em></a>, we can begin receiving and
responding to messages. Now we can register a handler for the <a class="reference internal" href="../event_index.html#term-message"><em class="xref std std-term">message</em></a> event that is raised
whenever a messsage is received.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
   <span class="nb">super</span><span class="p">(</span><span class="n">EchoBot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

   <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="s">&#39;session_start&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../event_index.html#term-message"><em class="xref std std-term">message</em></a> event is fired whenever a <tt class="docutils literal"><span class="pre">&lt;message</span> <span class="pre">/&gt;</span></tt> stanza is received, including for
group chat messages, errors, etc. Properly responding to messages thus requires checking the
<tt class="docutils literal"><span class="pre">'type'</span></tt> interface of the message <a class="reference internal" href="../glossary.html#term-stanza-object"><em class="xref std std-term">stanza object</em></a>. For responding to only messages
addressed to our bot (and not from a chat room), we check that the type is either <tt class="docutils literal"><span class="pre">normal</span></tt>
or <tt class="docutils literal"><span class="pre">chat</span></tt>. (Other potential types are <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">headline</span></tt>, and <tt class="docutils literal"><span class="pre">groupchat</span></tt>.)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="s">&#39;chat&#39;</span><span class="p">):</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s">&quot;Thanks for sending:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
</pre></div>
</div>
<p>Let&#8217;s take a closer look at the <tt class="docutils literal"><span class="pre">.reply()</span></tt> method used above. For message stanzas,
<tt class="docutils literal"><span class="pre">.reply()</span></tt> accepts the parameter <tt class="docutils literal"><span class="pre">body</span></tt> (also as the first positional argument),
which is then used as the value of the <tt class="docutils literal"><span class="pre">&lt;body</span> <span class="pre">/&gt;</span></tt> element of the message.
Setting the appropriate <tt class="docutils literal"><span class="pre">to</span></tt> JID is also handled by <tt class="docutils literal"><span class="pre">.reply()</span></tt>.</p>
<p>Another way to have sent the reply message would be to use <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.send_message" title="sleekxmpp.basexmpp.BaseXMPP.send_message"><tt class="xref py py-meth docutils literal"><span class="pre">send_message</span></tt></a>,
which is a convenience method for generating and sending a message based on the values passed to it. If we were to use
this method, the above code would look as so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="s">&#39;chat&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">mto</span><span class="o">=</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;from&#39;</span><span class="p">],</span>
                          <span class="n">mbody</span><span class="o">=</span><span class="s">&#39;Thanks for sending:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Whichever method you choose to use, the results in action will look like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;message</span> <span class="na">to=</span><span class="s">&quot;echobot@example.com&quot;</span> <span class="na">from=</span><span class="s">&quot;someuser@example.net&quot;</span> <span class="na">type=</span><span class="s">&quot;chat&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;body&gt;</span>Hej!<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/message&gt;</span>

<span class="nt">&lt;message</span> <span class="na">to=</span><span class="s">&quot;someuser@example.net&quot;</span> <span class="na">type=</span><span class="s">&quot;chat&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;body&gt;</span>Thanks for sending:
  Hej!<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/message&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XMPP does not require stanzas sent by a client to include a <tt class="docutils literal"><span class="pre">from</span></tt> attribute, and
leaves that responsibility to the XMPP server. However, if a sent stanza does
include a <tt class="docutils literal"><span class="pre">from</span></tt> attribute, it must match the full JID of the client or some
servers will reject it. SleekXMPP thus leaves out the <tt class="docutils literal"><span class="pre">from</span></tt> attribute when replying
using a client connection.</p>
</div>
</div>
</div>
<div class="section" id="command-line-arguments-and-logging">
<h2>Command Line Arguments and Logging<a class="headerlink" href="#command-line-arguments-and-logging" title="Permalink to this headline">¶</a></h2>
<p>While this isn&#8217;t part of SleekXMPP itself, we do want our echo bot program to be able
to accept a JID and password from the command line instead of hard coding them. We will
use the <tt class="docutils literal"><span class="pre">optparse</span></tt> module for this, though there are several alternative methods, including
the newer <tt class="docutils literal"><span class="pre">argparse</span></tt> module.</p>
<p>We want to accept three parameters: the JID for the echo bot, its password, and a flag for
displaying the debugging logs. We also want these to be optional parameters, since passing
a password directly through the command line can be a security risk.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">optp</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>

    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set logging to DEBUG&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;loglevel&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-j&quot;</span><span class="p">,</span> <span class="s">&quot;--jid&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;jid&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;JID to use&quot;</span><span class="p">)</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-p&quot;</span><span class="p">,</span> <span class="s">&quot;--password&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;password to use&quot;</span><span class="p">)</span>

    <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">optp</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">jid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">jid</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Username: &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s">&quot;Password: &quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we included a flag for enabling debugging logs, we need to configure the
<tt class="docutils literal"><span class="pre">logging</span></tt> module to behave accordingly.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c"># .. option parsing from above ..</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span>
                        <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%(levelname)-8s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-the-server-and-processing">
<h2>Connecting to the Server and Processing<a class="headerlink" href="#connecting-to-the-server-and-processing" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>There are three steps remaining until our echo bot is complete:</dt>
<dd><ol class="first last arabic simple">
<li>We need to instantiate the bot.</li>
<li>The bot needs to connect to an XMPP server.</li>
<li>We have to instruct the bot to start running and processing messages.</li>
</ol>
</dd>
</dl>
<p>Creating the bot is straightforward, but we can also perform some configuration
at this stage. For example, let&#8217;s say we want our bot to support <a class="reference external" href="http://xmpp.org/extensions/xep-0030.html">service discovery</a> and <a class="reference external" href="http://xmpp.org/extensions/xep-0199.html">pings</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c"># .. option parsing and logging steps from above</span>

    <span class="n">xmpp</span> <span class="o">=</span> <span class="n">EchoBot</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">jid</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
    <span class="n">xmpp</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="s">&#39;xep_0030&#39;</span><span class="p">)</span> <span class="c"># Service Discovery</span>
    <span class="n">xmpp</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="s">&#39;xep_0199&#39;</span><span class="p">)</span> <span class="c"># Ping</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">EchoBot</span></tt> class had a hard dependency on a plugin, we could register that plugin in
the <tt class="docutils literal"><span class="pre">EchoBot.__init__</span></tt> method instead.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are using the OpenFire server, you will need to include an additional
configuration step. OpenFire supports a different version of SSL than what
most servers and SleekXMPP support.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">xmpp</span><span class="o">.</span><span class="n">ssl_version</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_SSLv3</span>
</pre></div>
</div>
</div>
<p>Now we&#8217;re ready to connect and begin echoing messages. If you have the package
<tt class="docutils literal"><span class="pre">dnspython</span></tt> installed, then the <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP" title="sleekxmpp.clientxmpp.ClientXMPP"><tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.clientxmpp.ClientXMPP()</span></tt></a> method
will perform a DNS query to find the appropriate server to connect to for the
given JID. If you do not have <tt class="docutils literal"><span class="pre">dnspython</span></tt>, then SleekXMPP will attempt to
connect to the hostname used by the JID, unless an address tuple is supplied
to <a class="reference internal" href="../api/clientxmpp.html#sleekxmpp.clientxmpp.ClientXMPP" title="sleekxmpp.clientxmpp.ClientXMPP"><tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.clientxmpp.ClientXMPP()</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c"># .. option parsing &amp; echo bot configuration</span>

    <span class="k">if</span> <span class="n">xmpp</span><span class="o">.</span><span class="n">connect</span><span class="p">():</span>
        <span class="n">xmpp</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Unable to connect&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For Google Talk users withouth <tt class="docutils literal"><span class="pre">dnspython</span></tt> installed, the above code
should look like:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c"># .. option parsing &amp; echo bot configuration</span>

    <span class="k">if</span> <span class="n">xmpp</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;talk.google.com&#39;</span><span class="p">,</span> <span class="mi">5222</span><span class="p">)):</span>
        <span class="n">xmpp</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Unable to connect&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To begin responding to messages, you&#8217;ll see we called <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.process" title="sleekxmpp.basexmpp.BaseXMPP.process"><tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.basexmpp.BaseXMPP.process()</span></tt></a>
which will start the event handling, send queue, and XML reader threads. It will also call
the <tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.plugins.base.base_plugin.post_init()</span></tt> method on all registered plugins. By
passing <tt class="docutils literal"><span class="pre">block=True</span></tt> to <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.process" title="sleekxmpp.basexmpp.BaseXMPP.process"><tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.basexmpp.BaseXMPP.process()</span></tt></a> we are running the
main processing loop in the main thread of execution. The <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.process" title="sleekxmpp.basexmpp.BaseXMPP.process"><tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.basexmpp.BaseXMPP.process()</span></tt></a>
call will not return until after SleekXMPP disconnects. If you need to run the client in the background
for another program, use <tt class="docutils literal"><span class="pre">block=False</span></tt> to spawn the processing loop in its own thread.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Before 1.0, controlling the blocking behaviour of <a class="reference internal" href="../api/basexmpp.html#sleekxmpp.basexmpp.BaseXMPP.process" title="sleekxmpp.basexmpp.BaseXMPP.process"><tt class="xref py py-meth docutils literal"><span class="pre">sleekxmpp.basexmpp.BaseXMPP.process()</span></tt></a> was
done via the <tt class="docutils literal"><span class="pre">threaded</span></tt> argument. This arrangement was a source of confusion because some users
interpreted that as controlling whether or not SleekXMPP used threads at all, instead of how
the processing loop itself was spawned.</p>
<p class="last">The statements <tt class="docutils literal"><span class="pre">xmpp.process(threaded=False)</span></tt> and <tt class="docutils literal"><span class="pre">xmpp.process(block=True)</span></tt> are equivalent.</p>
</div>
</div>
<div class="section" id="the-final-product">
<span id="echobot-complete"></span><h2>The Final Product<a class="headerlink" href="#the-final-product" title="Permalink to this headline">¶</a></h2>
<p>Here then is what the final result should look like after working through the guide above. The code
can also be found in the SleekXMPP <a class="reference external" href="http://github.com/fritzy/SleekXMPP/tree/master/examples">examples directory</a>.</p>
<div class="compound">
<p class="compound-first">You can run the code using:</p>
<div class="compound-middle highlight-sh"><div class="highlight"><pre>python echobot.py -d -j echobot@example.com
</pre></div>
</div>
<p class="compound-last">which will prompt for the password and then begin echoing messages. To test, open
your regular IM client and start a chat with the echo bot. Messages you send to it should
be mirrored back to you. Be careful if you are using the same JID for the echo bot that
you also have logged in with another IM client. Messages could be routed to your IM client instead
of the bot.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SleekXMPP: The Sleek XMPP Library</span>
<span class="sd">    Copyright (C) 2010  Nathanael C. Fritz</span>
<span class="sd">    This file is part of SleekXMPP.</span>

<span class="sd">    See the file LICENSE for copying permission.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>

<span class="kn">import</span> <span class="nn">sleekxmpp</span>

<span class="c"># Python versions before 3.0 do not use UTF-8 encoding</span>
<span class="c"># by default. To ensure that Unicode is handled properly</span>
<span class="c"># throughout SleekXMPP, we will set the default encoding</span>
<span class="c"># ourselves to UTF-8.</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
    <span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">raw_input</span> <span class="o">=</span> <span class="nb">input</span>


<span class="k">class</span> <span class="nc">EchoBot</span><span class="p">(</span><span class="n">sleekxmpp</span><span class="o">.</span><span class="n">ClientXMPP</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple SleekXMPP bot that will echo messages it</span>
<span class="sd">    receives, along with a short thank you message.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">sleekxmpp</span><span class="o">.</span><span class="n">ClientXMPP</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

        <span class="c"># The session_start event will be triggered when</span>
        <span class="c"># the bot establishes its connection with the server</span>
        <span class="c"># and the XML streams are ready for use. We want to</span>
        <span class="c"># listen for this event so that we we can intialize</span>
        <span class="c"># our roster.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="s">&quot;session_start&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="c"># The message event is triggered whenever a message</span>
        <span class="c"># stanza is received. Be aware that that includes</span>
        <span class="c"># MUC messages and error messages.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="s">&quot;message&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the session_start event.</span>

<span class="sd">        Typical actions for the session_start event are</span>
<span class="sd">        requesting the roster and broadcasting an intial</span>
<span class="sd">        presence stanza.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            event -- An empty dictionary. The session_start</span>
<span class="sd">                     event does not provide any additional</span>
<span class="sd">                     data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_presence</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_roster</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process incoming message stanzas. Be aware that this also</span>
<span class="sd">        includes MUC messages and error messages. It is usually</span>
<span class="sd">        a good idea to check the messages&#39;s type before processing</span>
<span class="sd">        or sending replies.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            msg -- The received message stanza. See the documentation</span>
<span class="sd">                   for stanza objects and the Message stanza to see</span>
<span class="sd">                   how it may be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;chat&#39;</span><span class="p">,</span> <span class="s">&#39;normal&#39;</span><span class="p">):</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s">&quot;Thanks for sending</span><span class="se">\n</span><span class="si">%(body)s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Setup the command line arguments.</span>
    <span class="n">optp</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">()</span>

    <span class="c"># Output verbosity options.</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-q&#39;</span><span class="p">,</span> <span class="s">&#39;--quiet&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set logging to ERROR&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;loglevel&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--debug&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set logging to DEBUG&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;loglevel&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--verbose&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;set logging to COMM&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;loglevel&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="c"># JID and password options.</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-j&quot;</span><span class="p">,</span> <span class="s">&quot;--jid&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;jid&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;JID to use&quot;</span><span class="p">)</span>
    <span class="n">optp</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-p&quot;</span><span class="p">,</span> <span class="s">&quot;--password&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;password to use&quot;</span><span class="p">)</span>

    <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">optp</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c"># Setup logging.</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">loglevel</span><span class="p">,</span>
                        <span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%(levelname)-8s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">jid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">jid</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Username: &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s">&quot;Password: &quot;</span><span class="p">)</span>

    <span class="c"># Setup the EchoBot and register plugins. Note that while plugins may</span>
    <span class="c"># have interdependencies, the order in which you register them does</span>
    <span class="c"># not matter.</span>
    <span class="n">xmpp</span> <span class="o">=</span> <span class="n">EchoBot</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">jid</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
    <span class="n">xmpp</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="s">&#39;xep_0030&#39;</span><span class="p">)</span> <span class="c"># Service Discovery</span>
    <span class="n">xmpp</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="s">&#39;xep_0004&#39;</span><span class="p">)</span> <span class="c"># Data Forms</span>
    <span class="n">xmpp</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="s">&#39;xep_0060&#39;</span><span class="p">)</span> <span class="c"># PubSub</span>
    <span class="n">xmpp</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="s">&#39;xep_0199&#39;</span><span class="p">)</span> <span class="c"># XMPP Ping</span>

    <span class="c"># If you are working with an OpenFire server, you may need</span>
    <span class="c"># to adjust the SSL version used:</span>
    <span class="c"># xmpp.ssl_version = ssl.PROTOCOL_SSLv3</span>

    <span class="c"># If you want to verify the SSL certificates offered by a server:</span>
    <span class="c"># xmpp.ca_certs = &quot;path/to/ca/cert&quot;</span>

    <span class="c"># Connect to the XMPP server and start processing XMPP stanzas.</span>
    <span class="k">if</span> <span class="n">xmpp</span><span class="o">.</span><span class="n">connect</span><span class="p">():</span>
        <span class="c"># If you do not have the pydns library installed, you will need</span>
        <span class="c"># to manually specify the name of the server if it does not match</span>
        <span class="c"># the one in the JID. For example, to use Google Talk you would</span>
        <span class="c"># need to use:</span>
        <span class="c">#</span>
        <span class="c"># if xmpp.connect((&#39;talk.google.com&#39;, 5222)):</span>
        <span class="c">#     ...</span>
        <span class="n">xmpp</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unable to connect.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SleekXMPP Quickstart - Echo Bot</a><ul>
<li><a class="reference internal" href="#tl-dr-just-give-me-the-code">TL;DR Just Give Me the Code</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#default-encoding">Default Encoding</a></li>
<li><a class="reference internal" href="#creating-the-echobot-class">Creating the EchoBot Class</a><ul>
<li><a class="reference internal" href="#handling-session-start">Handling Session Start</a></li>
<li><a class="reference internal" href="#responding-to-messages">Responding to Messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#command-line-arguments-and-logging">Command Line Arguments and Logging</a></li>
<li><a class="reference internal" href="#connecting-to-the-server-and-processing">Connecting to the Server and Processing</a></li>
<li><a class="reference internal" href="#the-final-product">The Final Product</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">SleekXMPP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sendlogout.html"
                        title="next chapter">Sign in, Send a Message, and Disconnect</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/getting_started/echobot.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sendlogout.html" title="Sign in, Send a Message, and Disconnect"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="SleekXMPP"
             >previous</a> |</li>
        <li><a href="../index.html">1.0RC3 Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Nathan Fritz, Lance Stout.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>